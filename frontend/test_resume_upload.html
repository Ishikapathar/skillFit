<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Resume Upload</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen py-12">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Test Resume Upload</h2>
        
        <div class="mb-4">
            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Student Email:</label>
            <input type="email" id="email" value="test@example.com" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="mb-6">
            <label for="resume" class="block text-sm font-medium text-gray-700 mb-2">Upload Resume:</label>
            <input type="file" id="resume" accept=".pdf,.doc,.docx" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <button id="uploadBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
            Upload Resume
        </button>
        
        <div id="uploadResult" class="mt-6 hidden">
            <h3 class="text-lg font-semibold mb-2 text-gray-800">Analysis Results:</h3>
            <div id="resultContent" class="bg-gray-50 p-4 rounded-md text-sm text-gray-700"></div>
        </div>
        
        <div class="mt-6">
            <button id="dashboardBtn" class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
                View Dashboard
            </button>
        </div>
        
        <div id="dashboardResult" class="mt-6 hidden">
            <h3 class="text-lg font-semibold mb-2 text-gray-800">Dashboard Data:</h3>
            <div id="dashboardContent" class="bg-blue-50 p-4 rounded-md text-sm text-gray-700 max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        document.getElementById('uploadBtn').addEventListener('click', async function() {
            const email = document.getElementById('email').value;
            const fileInput = document.getElementById('resume');
            const file = fileInput.files[0];
            
            if (!email || !file) {
                alert('Please enter email and select a resume file');
                return;
            }
            
            try {
                // Convert file to base64
                const reader = new FileReader();
                reader.onload = async function(e) {
                    const base64Data = e.target.result;
                    
                    const uploadData = {
                        student_email: email,
                        resume_data: base64Data,
                        filename: file.name,
                        file_type: file.type
                    };
                    
                    // Upload resume
                    const response = await fetch('http://127.0.0.1:8000/upload_resume', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(uploadData)
                    });
                    
                    const result = await response.json();
                    
                    // Display results
                    document.getElementById('uploadResult').classList.remove('hidden');
                    document.getElementById('resultContent').innerHTML = `
                        <div class="space-y-2">
                            <p><strong>Success:</strong> ${result.success}</p>
                            <p><strong>Message:</strong> ${result.message}</p>
                            ${result.analysis_preview ? `
                                <div class="mt-3 space-y-1">
                                    <p><strong>Skills Found:</strong> ${result.analysis_preview.skills_found}</p>
                                    <p><strong>Projects Found:</strong> ${result.analysis_preview.projects_found}</p>
                                    <p><strong>Experience Years:</strong> ${result.analysis_preview.experience_years}</p>
                                    <p><strong>Education Level:</strong> ${result.analysis_preview.education_level}</p>
                                </div>
                            ` : ''}
                        </div>
                    `;
                };
                
                reader.readAsDataURL(file);
            } catch (error) {
                document.getElementById('uploadResult').classList.remove('hidden');
                document.getElementById('resultContent').innerHTML = `<p class="text-red-600">Error: ${error.message}</p>`;
            }
        });
        
        document.getElementById('dashboardBtn').addEventListener('click', async function() {
            const email = document.getElementById('email').value;
            
            if (!email) {
                alert('Please enter email');
                return;
            }
            
            try {
                const response = await fetch('http://127.0.0.1:8000/get_dashboard_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        student_email: email
                    })
                });
                
                const result = await response.json();
                
                // Display dashboard data
                document.getElementById('dashboardResult').classList.remove('hidden');
                document.getElementById('dashboardContent').innerHTML = `
                    <pre class="whitespace-pre-wrap text-xs">${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('dashboardResult').classList.remove('hidden');
                document.getElementById('dashboardContent').innerHTML = `<p class="text-red-600">Error: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>